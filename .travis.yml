sudo: required
language: node_js
node_js:
- '8'
services:
- docker
cache:
  directories:
  - src/angular_frontend/node_modules
addons:
  ssh_known_hosts:
  - 146.185.181.250
  - fg@fgbeta.samfundet.no
jobs:
  include:
  - stage: test django
    env:
    - DOCKER_COMPOSE_VERSION=1.18.0
    install:
    - docker -v
    - sudo rm /usr/local/bin/docker-compose
    - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname
      -s`-`uname -m` > docker-compose
    - chmod +x docker-compose
    - sudo mv docker-compose /usr/local/bin
    - docker-compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.travis.yml
      down
    - docker-compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.travis.yml
      build
    - docker-compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.travis.yml
      up -d
    - docker-compose -f docker-compose.yml -f docker-compose.override.yml -f docker-compose.travis.yml
      ps
    script:
    - sleep 5
    - bash django-tests.sh
  - stage: test angular
    install:
    - npm install -g @angular/cli@1.6.3
    - cd src/angular_frontend && npm install
    script:
    - ng lint
    - ng build --prod
notifications:
  slack:
    secure: ORBxFkp34to5F3qHhruty2DyfSuVKtbJ35c8eJkgIUhR0TnOmWHJMX+afTaBqOXVjwOQY2v1X7Ifs6hEPU1H5CTZ7UV1Xz5Dp418dwkHuCwIpfxppVbJOqwtlxgYeHGa0/jwtWxcs9HQ5dTOObCr4Xxbz8Bl5/MRmRrKH/yVHdhm8Lwy4HQ0+j1+ouxuE5V+594tvhRP98PgmbEO3bFHXqbh9zeluw7zkidDvthC9EVZZbQoqZ4GrG4iuiYiR+gdAJcA76n45yOgpqEOvqrW+Z71a18bAy4ByzwgPPwyg35/WHMZ/C9vNJZohVSwnH/ak2mnaI1fr/rcD7wSiewyiLg2Cu01b5i572CTQ1fMBCKhb1uYbdftV++MNrQpMhvHDdUboFAjxYJ4N6FLj0ywSuUM2RqqCsskAXELPfgACuUZqxvFmRqOba1K0dBocXahJmWOJHErRG4NVFTAmgnEH0LE0JWPobU8TCTJoabga2UwuDTp+kRj4a5Tf+E5rDZWcEOudZzJKMRSGJ+/pm9lyeiYlW8oy58vB5l8b+dJp1vYXcwDy1HSBzbKOweIsaghMvFmVfAn7hrPwfrQDI8szLZM2v+YPSzQtvELaBESDaE5kF7RgdBBjP24Oi2kJR1+ZtrplQNpgy2Nfm3vz4ZIe01y5opVO11k8ciWXGM5WIk=
    on_success: always
    on_failure: always
